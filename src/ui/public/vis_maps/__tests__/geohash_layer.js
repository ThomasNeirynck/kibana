import expect from 'expect.js';
import KibanaMap from 'ui/vis_maps/kibana_map';
import GeohashLayer from 'ui/vis_maps/geohash_layer';
import sampleData from './geohash_sample_data';

describe('kibana_map tests', function () {

  let domNode;
  let kibanaMap;


  function setupDOM() {
    domNode = document.createElement('div');
    domNode.style.top = '0';
    domNode.style.left = '0';
    domNode.style.width = '512px';
    domNode.style.height = '512px';
    domNode.style.position = 'fixed';
    domNode.style['pointer-events'] = 'none';
    document.body.appendChild(domNode);
  }

  function teardownDOM() {
    domNode.innerHTML = '';
    document.body.removeChild(domNode);
  }


  describe('GeohashGridLayer - basics', function () {

    beforeEach(async function () {
      setupDOM();
      kibanaMap = new KibanaMap(domNode, {
        minZoom: 1,
        maxZoom: 10
      });
      kibanaMap.setZoomLevel(3);
      kibanaMap.setCenter({
        lon: -100,
        lat: 40
      });
    });

    afterEach(function () {
      kibanaMap.destroy();
      teardownDOM();
    });

    it('create and verify', function () {

      const options = {
        'mapType': 'Scaled Circle Markers',
        'heatmap': {
          'heatBlur': 15,
          'heatMaxZoom': 0,
          'heatMinOpacity': 0.1,
          'heatNormalizeData': true,
          'heatRadius': 25
        }
      };

      const geohashLayer = new GeohashLayer(sampleData, options, kibanaMap.getZoomLevel(), kibanaMap);
      kibanaMap.addLayer(geohashLayer);

      const markers = domNode.querySelectorAll('path.leaflet-clickable');
      expect(markers.length).to.equal(32);

      // [{"fill":"#bd0026","d":"M343,263.8A19.2,19.2,0,1,1,342.9,263.8 z"},{"fill":"#bd0026","d":"M343,225.03843394373595A18.961566056264047,18.961566056264047,0,1,1,342.9,225.03843394373595 z"},{"fill":"#bd0026","d":"M283,264.19815701843777A17.80184298156226,17.80184298156226,0,1,1,282.9,264.19815701843777 z"},{"fill":"#f03b20","d":"M405,224.2748797495895A16.72512025041049,16.72512025041049,0,1,1,404.9,224.2748797495895 z"},{"fill":"#f03b20","d":"M285,223.50180417608374A16.498195823916255,16.498195823916255,0,1,1,284.9,223.50180417608374 z"},{"fill":"#f03b20","d":"M343,299.1036928470748A15.896307152925205,15.896307152925205,0,1,1,342.9,299.1036928470748 z"},{"fill":"#f03b20","d":"M283,300.2846189453604A15.71538105463958,15.71538105463958,0,1,1,282.9,300.2846189453604 z"},{"fill":"#fd8d3c","d":"M148,267.0272116156895A13.972788384310489,13.972788384310489,0,1,1,147.9,267.0272116156895 z"},{"fill":"#feb24c","d":"M219,270.4178825645856A11.582117435414355,11.582117435414355,0,1,1,218.9,270.4178825645856 z"},{"fill":"#feb24c","d":"M146,189.63311915018554A11.366880849814459,11.366880849814459,0,1,1,145.9,189.63311915018554 z"},{"fill":"#feb24c","d":"M281,191.96973262756177A11.030267372438226,11.030267372438226,0,1,1,280.9,191.96973262756177 z"},{"fill":"#feb24c","d":"M220,231.85362974571228A10.146370254287714,10.146370254287714,0,1,1,219.9,231.85362974571228 z"},{"fill":"#feb24c","d":"M144,231.1923722152369A9.807627784763092,9.807627784763092,0,1,1,143.9,231.1923722152369 z"},{"fill":"#feb24c","d":"M387,268.27221854599287A9.72778145400714,9.72778145400714,0,1,1,386.9,268.27221854599287 z"},{"fill":"#feb24c","d":"M217,191.09542834646925A8.90457165353074,8.90457165353074,0,1,1,216.9,191.09542834646925 z"},{"fill":"#fed976","d":"M218,300.40744573968243A8.592554260317598,8.592554260317598,0,1,1,217.9,300.40744573968243 z"},{"fill":"#fed976","d":"M363,339.5411821762003A7.458817823799684,7.458817823799684,0,1,1,362.9,339.5411821762003 z"},{"fill":"#fed976","d":"M331,205.43072931381437A6.569270686185644,6.569270686185644,0,1,1,330.9,205.43072931381437 z"},{"fill":"#fed976","d":"M163,299.9012571034098A5.098742896590189,5.098742896590189,0,1,1,162.9,299.9012571034098 z"},{"fill":"#fed976","d":"M34,77.6735731867532A4.326426813246795,4.326426813246795,0,1,1,33.9,77.6735731867532 z"},{"fill":"#fed976","d":"M268,341.7954688958982A4.204531104101819,4.204531104101819,0,1,1,267.9,341.7954688958982 z"},{"fill":"#fed976","d":"M71,118.82649906983305A4.173500930166947,4.173500930166947,0,1,1,70.9,118.82649906983305 z"},{"fill":"#fed976","d":"M119,235.1169130974434A3.8830869025566206,3.8830869025566206,0,1,1,118.9,235.1169130974434 z"},{"fill":"#fed976","d":"M451,396.15053353027315A3.849466469726874,3.849466469726874,0,1,1,450.9,396.15053353027315 z"},{"fill":"#fed976","d":"M64,104.18445019554242A3.815549804457569,3.815549804457569,0,1,1,63.9,104.18445019554242 z"},{"fill":"#fed976","d":"M7,15.430879972386867A3.5691200276131325,3.5691200276131325,0,1,1,6.9,15.430879972386867 z"},{"fill":"#fed976","d":"M434,206.8985557756997A3.1014442243003013,3.1014442243003013,0,1,1,433.9,206.8985557756997 z"},{"fill":"#fed976","d":"M119,201.2073035006183A2.792696499381677,2.792696499381677,0,1,1,118.9,201.2073035006183 z"},{"fill":"#fed976","d":"M-1,420.89773444794906A2.1022655520509095,2.1022655520509095,0,1,1,-1.1,420.89773444794906 z"},{"fill":"#fed976","d":"M443,217.859886428343A1.1401135716569843,1.1401135716569843,0,1,1,442.9,217.859886428343 z"},{"fill":"#fed976","d":"M121,260.85988642834303A1.1401135716569843,1.1401135716569843,0,1,1,120.9,260.85988642834303 z"},{"fill":"#fed976","d":"M-4,399.27892886445886A0.7210711355411324,0.7210711355411324,0,1,1,-4.1,399.27892886445886 z"}]
    });

  });

});
