<div class="forecasting-modal">
  <ml-message-bar ></ml-message-bar>
  <h3>Forecasting</h3>

  <div ng-if="previousForecasts.length > 0">
    <h4 class="view-forecast-title">View a previous forecast</h4><i ml-info-icon="forecasting_modal_view_list" />

    <div class="previous-forecast-list">
      <table>
        <thead>
          <th>Created</th>
          <th>From</th>
          <th>To</th>
        </thead>
        <tbody >
          <tr ng-repeat="forecast in previousForecasts">
            <td><a class="kuiLink" href="" ng-click="viewForecast(forecast.id)">{{forecast.runTime}}</a></td>
            <td>{{forecast.earliestTime}}</td>
            <td>{{forecast.latestTime}}</td>
          </tr>
        </tbody>
      </table>
    </div>

    <hr />
  </div>

  <h4>Run a new forecast</h4>
  <div ng-show="showNumPartitionsWarning" class="warning-text">
    Note that this data contains more than {{partitionsWarningNumber}} partitions
    so running a forecast may take a long time and consume a high amount of resource.
  </div>
  <div class="form-group">
    <label for="forecastDuration" class="kuiLabel">Duration</label><i ml-info-icon="forecasting_modal_run_duration" />
    <div ng-class="privileges.canForecastJob && invalidJobState === undefined ? 'control-wrapper' : ['control-wrapper', 'disabled']"
      data-toggle="tooltip"
      ng-attr-tooltip="{{privileges.canForecastJob === false ? 'You do not have permission to run forecasts. Please contact your administrator.' :
        invalidJobState !== undefined ? 'Forecasts cannot be run on ' + invalidJobState + ' jobs' : undefined}}"
      tooltip-placement="bottom">
      <input
        id="forecastDuration"
        ng-model="newForecastDuration"
        ng-change="newForecastDurationChange()"
        ng-disabled="isForecastRunning === true || privileges.canForecastJob === false || invalidJobState !== undefined"
        required
        type="text"
        class="form-control" />
    </div>
    <div ng-class="privileges.canForecastJob && invalidJobState === undefined ? 'control-wrapper' : ['control-wrapper', 'disabled']"
      data-toggle="tooltip"
      ng-attr-tooltip="{{privileges.canForecastJob === false ? 'You do not have permission to run forecasts. Please contact your administrator.' :
        invalidJobState !== undefined ? 'Forecasts cannot be run on ' + invalidJobState + ' jobs' : undefined}}"
      tooltip-placement="left">
      <button
        class="kuiButton kuiButton--primary run-button"
        ng-click="checkJobStateAndRunForecast()"
        ng-disabled="newForecastDurationError !== null || isForecastRunning === true ||
          privileges.canForecastJob === false || invalidJobState !== undefined" >
        <i ng-if="isForecastRunning === false" class="fa fa-play" ></i>
        <i ng-if="isForecastRunning === true" class="fa fa-spinner fa-spin" ></i>
      </button>
    </div>
    <div ng-show="newForecastDurationError !== null" class="validation-error">{{newForecastDurationError}}</div>

    <div ng-show="runStatus.forecastRequested === true" class="status-item-list">
      <div class="status-item" ng-show="runStatus.jobOpening !== undefined">Opening job...
        <i ng-show="runStatus.jobOpening === REQUEST_STATES.ERROR" aria-hidden="true" style="color:red;" class="fa fa-remove"></i>
        <i ng-show="runStatus.jobOpening === REQUEST_STATES.WAITING" aria-hidden="true" class="fa fa-spinner fa-spin"></i>
        <i ng-show="runStatus.jobOpening === REQUEST_STATES.DONE" aria-hidden="true" style="color:green;" class="fa fa-check"></i>
      </div>

      <div class="status-item" ng-show="runStatus.forecastProgress !== undefined">Running forecast...
        <progressbar
            ng-show="runStatus.forecastProgress >= 0"
            ng-class="runStatus.forecastProgress < 3 ? 'empty-progress' : ''"
            animate="false"
            value="runStatus.forecastProgress"
            type="success">
          <b>{{runStatus.forecastProgress}}%</b>
        </progressbar>
        <i ng-show="runStatus.forecastProgress === REQUEST_STATES.ERROR" aria-hidden="true" style="color:red;" class="fa fa-remove"></i>
      </div>

      <div class="status-item" ng-show="runStatus.jobClosing !== undefined">Closing job...
        <i ng-show="runStatus.jobClosing === REQUEST_STATES.ERROR" aria-hidden="true" style="color:red;" class="fa fa-remove"></i>
        <i ng-show="runStatus.jobClosing === REQUEST_STATES.WAITING" aria-hidden="true" class="fa fa-spinner fa-spin"></i>
        <i ng-show="runStatus.jobClosing === REQUEST_STATES.DONE" aria-hidden="true" style="color:green;" class="fa fa-check"></i>
      </div>
    </div>

    <hr />
</div>

  <button
    ng-click="close()"
    class="kuiButton kuiButton--primary" >
    Close
  </button>
</div>
