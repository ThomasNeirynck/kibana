<div class="forecasting-modal">
  <ml-message-bar ></ml-message-bar>
  <h3>Forecasting</h3>

  <div ng-if="previousForecasts.length > 0">
    <h4 class="view-forecast-title">View a previous forecast</h4><i ml-info-icon="forecasting_modal_view_list" />

    <div class="previous-forecast-list">
      <table>
        <thead>
          <th>Created</th>
          <th>From</th>
          <th>To</th>
        </thead>
        <tbody >
          <tr ng-repeat="forecast in previousForecasts">
            <td><a class="kuiLink" href="" ng-click="viewForecast(forecast.id)">{{forecast.runTime}}</a></td>
            <td>{{forecast.earliestTime}}</td>
            <td>{{forecast.latestTime}}</td>
          </tr>
        </tbody>
      </table>
    </div>

    <hr />
  </div>

  <h4>Run a new forecast</h4>
  <div class="form-group">
    <label for="forecastDuration" class="kuiLabel">Duration</label>
    <div ng-class="privileges.canForecastJob && invalidJobState === undefined ? 'control-wrapper' : ['control-wrapper', 'disabled']"
      data-toggle="tooltip"
      ng-attr-tooltip="{{privileges.canForecastJob === false ? 'You do not have permission to run forecasts. Please contact your administrator.' :
        invalidJobState !== undefined ? 'Forecasts cannot be run on ' + invalidJobState + ' jobs' : undefined}}"
      tooltip-placement="bottom">
      <input
        id="forecastDuration"
        ng-model="newForecastDuration"
        ng-change="newForecastDurationChange()"
        ng-disabled="isForecastRunning === true || privileges.canForecastJob === false || invalidJobState !== undefined"
        required
        type="text"
        class="form-control" />
    </div>
    <div ng-class="privileges.canForecastJob && invalidJobState === undefined ? 'control-wrapper' : ['control-wrapper', 'disabled']"
      data-toggle="tooltip"
      ng-attr-tooltip="{{privileges.canForecastJob === false ? 'You do not have permission to run forecasts. Please contact your administrator.' :
        invalidJobState !== undefined ? 'Forecasts cannot be run on ' + invalidJobState + ' jobs' : undefined}}"
      tooltip-placement="left">
      <button
        class="kuiButton kuiButton--primary run-button"
        ng-click="checkJobStateAndRunForecast()"
        ng-disabled="newForecastDurationValid === false || isForecastRunning === true ||
          privileges.canForecastJob === false || invalidJobState !== undefined" >
        <i ng-if="isForecastRunning === false" class="fa fa-play" ></i>
        <i ng-if="isForecastRunning === true" class="fa fa-spinner fa-spin" ></i>
      </button>
    </div>
    <div ng-hide="newForecastDurationValid" class="validation-error">Invalid duration format</div>

    <hr />
</div>

  <button
    ng-click="close()"
    class="kuiButton kuiButton--primary" >
    Close
  </button>
</div>
