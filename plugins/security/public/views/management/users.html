<kbn-management-app section="elasticsearch">
  <div class="kuiNotice" ng-if="forbidden">
    <div class="kuiNotice__header">
      <h1 class="kuiNoticeTitle">
        <span class="fa fa-times kuiIcon--danger"></span>
        You do not have permission to manage users
      </h1>
      <div class="kuiNoticeText">
        Please contact your administrator.
      </div>
    </div>
  </div>

  <div class="kuiPage" ng-if="!forbidden">
    <!-- Table controls -->
    <div class="kuiTableControls">
      <div class="kuiTableControls__actions">
        <button
          ng-click="deleteUsers()"
          class="kuiButton kuiButton--danger kuiTableControlAction"
          ng-show="selectedUsers.length"
          tooltip="Delete selected users"
        >
          <span class="kuiButton__icon kuiIcon fa-trash"></span>
        </button>
        <a
          href="#/management/elasticsearch/users/edit"
          ng-click="newUser()"
          class="kuiButton kuiButton--primary kuiTableControlAction"
          ng-show="!selectedUsers.length"
          tooltip="Create new user"
          data-test-subj="createUserButton"
        >
          <span class="kuiButton__icon kuiIcon fa-plus"></span>
        </a>
      </div>
      <div class="kuiTableControls__input">
        <form role="form" class="fullWidth">
          <input
            aria-label="Filter"
            ng-model="query"
            class="kuiInput"
            type="text" placeholder="Filter..."
          />
        </form>
      </div>
    </div>

    <!-- Table -->
    <table class="table">
      <thead>
        <tr>
          <th><input type="checkbox" ng-click="toggleAll()" ng-checked="allSelected()" /></th>
          <th ng-click="toggleSort(sort, 'full_name')">
            Full Name
            <span aria-hidden="true" class="fa" ng-show="sort.orderBy == 'full_name'" ng-class="{'fa-caret-down': sort.reverse, 'fa-caret-up': !sort.reverse}"></span>
          </th>
          <th ng-click="toggleSort(sort, 'username')">
            Username
            <span aria-hidden="true" class="fa" ng-show="sort.orderBy == 'username'" ng-class="{'fa-caret-down': sort.reverse, 'fa-caret-up': !sort.reverse}"></span>
          </th>
          <th ng-click="toggleSort(sort, 'roles')">
            Roles
            <span aria-hidden="true" class="fa" ng-show="sort.orderBy == 'roles'" ng-class="{'fa-caret-down': sort.reverse, 'fa-caret-up': !sort.reverse}"></span>
          </th>
          <th>
            Reserved
            <span
              class="fa fa-question-circle"
              tooltip="Reserved users are built-in and cannot be removed or modified. Only the password may be changed."
            ></span>
          </th>
        </tr>
      </thead>
      <tbody>
        <tr
          ng-repeat="user in users | orderBy:'username' | filter:query | orderBy:sort.orderBy:sort.reverse"
          data-test-subj="userRow"
        >
          <td>
            <input type="checkbox" ng-click="toggle(selectedUsers, user)" ng-checked="includes(selectedUsers, user)"  ng-disabled="user.metadata._reserved" />
          </td>
          <td>
            <a
              ng-href="#/management/elasticsearch/users/edit/{{user.username}}"
              data-test-subj="userRowFullName"
            >
              {{user.full_name}}
            </a>
          </td>
          <td>
            <a
              ng-href="#/management/elasticsearch/users/edit/{{user.username}}"
              data-test-subj="userRowUserName"
            >
              {{user.username}}
            </a>
          </td>
          <td data-test-subj="userRowRoles">
            <span ng-repeat="role in user.roles">
              <a ng-href="#/management/elasticsearch/roles/edit/{{role}}">{{role}}</a><span ng-if="!$last">,</span>
            </span>
          </td>
          <td>
            <div
              ng-if="user.metadata._reserved"
              class="fa fa-check"
              data-test-subj="userRowReserved"
            ></div>
          </td>
        </tr>
        <tr ng-show="!(users | filter:query).length">
          <td colspan="5">No <span ng-show="query">matching</span> users found.</td>
        </tr>
      </tbody>
    </table>
  </div>
</kbn-management-app>
